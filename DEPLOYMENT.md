# Pedalist E-commerce - Render Deployment Guide

## üöÄ Quick Deploy to Render

This guide will help you deploy the Pedalist E-commerce platform to Render.com.

---

## Prerequisites

Before deploying, ensure you have:

- ‚úÖ GitHub account with this repository pushed
- ‚úÖ Render account ([Sign up free](https://render.com/))
- ‚úÖ MongoDB Atlas account ([Free tier available](https://www.mongodb.com/cloud/atlas))
- ‚úÖ All required API keys ready (Razorpay, Google OAuth, Gmail)

---

## Step 1: Prepare MongoDB Atlas

### Create MongoDB Database

1. Go to [MongoDB Atlas](https://cloud.mongodb.com/)
2. Create a new cluster (Free M0 tier)
3. Create a database user:
   - Username: `pedalist_admin` (or your choice)
   - Password: Generate a strong password
4. Whitelist IP addresses:
   - Add `0.0.0.0/0` (allows access from anywhere - needed for Render)
5. Get your connection string:
   - Click "Connect" ‚Üí "Connect your application"
   - Copy the connection string
   - Replace `<password>` with your database password
   - Example: `mongodb+srv://pedalist_admin:YourPassword@cluster0.xxxxx.mongodb.net/pedalist?retryWrites=true&w=majority`

---

## Step 2: Deploy to Render

### Method 1: Using render.yaml (Recommended)

1. **Push code to GitHub** (if not already done):
   \`\`\`bash
   git add .
   git commit -m "Prepare for Render deployment"
   git push origin main
   \`\`\`

2. **Deploy on Render**:

   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New +" ‚Üí "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect `render.yaml`
   - Click "Apply"

3. **Configure Environment Variables** in Render Dashboard:

   Navigate to your service ‚Üí "Environment" tab and add:

   | Key                    | Value                                | Notes                    |
   | ---------------------- | ------------------------------------ | ------------------------ |
   | `MONGODB_URI`          | Your MongoDB Atlas connection string | ‚ö†Ô∏è Required              |
   | `SESSION_SECRET`       | Auto-generated by Render             | ‚úÖ Auto-configured       |
   | `GOOGLE_CLIENT_ID`     | Your Google OAuth Client ID          | From Google Console      |
   | `GOOGLE_CLIENT_SECRET` | Your Google OAuth Secret             | From Google Console      |
   | `RAZORPAY_ID_KEY`      | Your Razorpay Key ID                 | From Razorpay Dashboard  |
   | `RAZORPAY_SECRET_KEY`  | Your Razorpay Secret Key             | From Razorpay Dashboard  |
   | `NODEMAILER_EMAIL`     | Your Gmail address                   | For sending emails       |
   | `NODEMAILER_PASSWORD`  | Gmail App Password                   | Not your Gmail password! |
   | `RENDER_EXTERNAL_URL`  | `https://your-app.onrender.com`      | Update after deployment  |
   | `ALLOWED_ORIGINS`      | `https://your-app.onrender.com`      | For CORS                 |

### Method 2: Manual Setup

1. **Create New Web Service**:

   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository

2. **Configure Build Settings**:

   - **Name**: `pedalist-ecommerce`
   - **Region**: Choose your preferred region
   - **Branch**: `main`
   - **Root Directory**: Leave empty
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: Free (or upgrade as needed)

3. **Add Environment Variables** (same as Method 1)

---

## Step 3: Update Google OAuth Redirect URI

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to your OAuth credentials
3. Add authorized redirect URI:
   \`\`\`
   https://your-app-name.onrender.com/auth/google/callback
   \`\`\`

---

## Step 4: Update Render External URL

After deployment:

1. Copy your Render app URL (e.g., `https://pedalist-ecommerce-abcd.onrender.com`)
2. In Render Dashboard ‚Üí Environment:
   - Update `RENDER_EXTERNAL_URL` to your actual URL
   - Update `ALLOWED_ORIGINS` to your actual URL
3. Click "Save Changes"
4. Render will automatically redeploy

---

## Step 5: Verify Deployment

### Check Health Status

Visit these endpoints:

- **Health Check**: `https://your-app.onrender.com/health`

  - Should return: `{"status":"OK","timestamp":"...","uptime":123,"services":{"database":"connected"}}`

- **Ping**: `https://your-app.onrender.com/ping`
  - Should return: `{"status":"alive","timestamp":"..."}`

### Test Application

1. Visit your app: `https://your-app.onrender.com`
2. Try user registration
3. Test Google OAuth login
4. Create a test product (as admin)
5. Place a test order

---

## Keep-Alive Feature

‚úÖ **Automatic Keep-Alive Configured!**

The app includes a cron job that pings itself every 14 minutes to prevent Render free tier from sleeping.

**How it works**:

- Cron job runs in production only
- Pings `/ping` endpoint every 14 minutes
- Keeps server awake 24/7 on free tier
- Logs each ping for monitoring

**View logs**:
\`\`\`
Render Dashboard ‚Üí Your Service ‚Üí Logs
\`\`\`

You should see:
\`\`\`
‚úÖ Keep-alive ping successful (156ms) - Server staying active
\`\`\`

---

## Environment Variables Reference

### Required Variables

\`\`\`env

# Database (MongoDB Atlas)

MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/pedalist

# Session Security

SESSION_SECRET=your-generated-secret-key

# Google OAuth

GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-xxxxxxxxxxxxx

# Razorpay Payment

RAZORPAY_ID_KEY=rzp_live_xxxxxxxxxxxxx
RAZORPAY_SECRET_KEY=xxxxxxxxxxxxxxxxxxxxx

# Email (Gmail)

NODEMAILER_EMAIL=your-email@gmail.com
NODEMAILER_PASSWORD=xxxx-xxxx-xxxx-xxxx

# Render Configuration

NODE_ENV=production
PORT=10000
RENDER_EXTERNAL_URL=https://your-app.onrender.com
ALLOWED_ORIGINS=https://your-app.onrender.com
\`\`\`

### Gmail App Password Setup

1. Enable 2-Factor Authentication on your Gmail
2. Go to: [Google Account ‚Üí Security ‚Üí App passwords](https://myaccount.google.com/apppasswords)
3. Generate new app password for "Mail"
4. Copy the 16-character password
5. Use this as `NODEMAILER_PASSWORD` (not your Gmail password!)

---

## Troubleshooting

### Issue: App crashes on startup

**Check logs for**:
\`\`\`
‚ùå Missing required environment variables
\`\`\`

**Solution**: Ensure all required environment variables are set in Render Dashboard

---

### Issue: Database connection fails

**Error**:
\`\`\`
‚ùå MongoDB Connection error
\`\`\`

**Solutions**:

1. Verify `MONGODB_URI` is correct
2. Check MongoDB Atlas IP whitelist includes `0.0.0.0/0`
3. Verify database user credentials
4. Ensure database name is correct in connection string

---

### Issue: Google OAuth not working

**Solutions**:

1. Verify redirect URI is added in Google Console:
   - `https://your-app.onrender.com/auth/google/callback`
2. Check `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` are correct
3. Ensure OAuth consent screen is published

---

### Issue: Emails not sending

**Solutions**:

1. Verify Gmail App Password (not regular password)
2. Check 2FA is enabled on Gmail
3. Verify `NODEMAILER_EMAIL` matches the Gmail account
4. Check Render logs for specific email errors

---

### Issue: Payment not working

**Solutions**:

1. Use Razorpay **live** credentials (not test) for production
2. Verify webhook URL if using Razorpay webhooks
3. Check Razorpay dashboard for API key status

---

## Performance Optimization

### Free Tier Optimizations

1. **Keep-Alive**: Already configured ‚úÖ
2. **Database Indexes**: Already added ‚úÖ
3. **Caching**: Consider adding Redis (Render has free Redis)

### Upgrading Performance

**Starter Plan ($7/month)**:

- No sleep on inactivity
- More CPU/RAM
- Better performance

**Add Redis** (Optional - Free tier available):
\`\`\`yaml

# Add to render.yaml

- type: redis
  name: pedalist-redis
  ipAllowList: []
  plan: free
  \`\`\`

Then add to environment:
\`\`\`env
REDIS_URL=${pedalist-redis.connectionString}
\`\`\`

---

## Monitoring & Logs

### View Real-time Logs

\`\`\`
Render Dashboard ‚Üí Your Service ‚Üí Logs
\`\`\`

### Log Types

- **Application Logs**: Winston structured logs
- **Build Logs**: npm install, dependencies
- **Deploy Logs**: Service startup, health checks

### Key Logs to Monitor

‚úÖ **Success**:
\`\`\`
‚úÖ All required environment variables are set
‚úÖ MongoDB Connected
‚úÖ Offer expiry cron job scheduled
‚úÖ Keep-alive cron job scheduled
üöÄ Server is running on port 10000 in production mode
\`\`\`

‚ùå **Errors**:
\`\`\`
‚ùå Missing required environment variables
‚ùå MongoDB Connection error
\`\`\`

---

## Scaling & Production

### Database

**MongoDB Atlas Scaling**:

- Free M0: 512MB storage (good for testing)
- M2: $9/month - 2GB storage
- M5: $25/month - 5GB storage

### Application

**Render Scaling**:

- **Free**: 750 hours/month, sleeps after 15min
- **Starter**: $7/month, always on
- **Standard**: $25/month, 2GB RAM
- **Pro**: Higher tiers for more resources

---

## Post-Deployment Checklist

After successful deployment:

- [ ] Health check endpoint returns 200
- [ ] User registration works
- [ ] Google OAuth login works
- [ ] Email verification received
- [ ] Admin panel accessible
- [ ] Products display correctly
- [ ] Cart functionality works
- [ ] Checkout process completes
- [ ] Payment integration works
- [ ] Order confirmation sent
- [ ] Keep-alive logs visible
- [ ] No error logs in production

---

## Support

**Render Documentation**: [https://render.com/docs](https://render.com/docs)  
**MongoDB Atlas**: [https://docs.atlas.mongodb.com/](https://docs.atlas.mongodb.com/)  
**Project Issues**: Open an issue on GitHub

---

## Security Checklist

Before going live:

- [ ] All environment variables use production credentials
- [ ] SESSION_SECRET is strong and unique
- [ ] MongoDB user has strong password
- [ ] IP whitelist configured in MongoDB
- [ ] HTTPS enforced (automatic on Render)
- [ ] CORS configured with actual domain
- [ ] Rate limiting active
- [ ] Input validation working
- [ ] Error logs don't expose sensitive data

---

**üéâ Congratulations! Your Pedalist e-commerce platform is now live on Render!**

For custom domain setup, see: [Render Custom Domains](https://render.com/docs/custom-domains)
